---
title: Fix domtree PrimaryMap.get() pointer handling
status: closed
priority: 2
issue-type: task
created-at: "2026-01-03T12:16:54.961166+02:00"
closed-at: "2026-01-03T12:22:25.879416+02:00"
---

File: src/ir/domtree.zig - multiple locations

PrimaryMap(Block, ?Block).get() returns ?*const ?Block (pointer to optional), but code treats it as ??Block (optional optional).

Need to systematically fix all idom.get() and ipdom.get() calls:
- Line 64, 572: ArrayList.deinit() needs allocator
- Line 108-110: old_idom pointer dereference
- Line 167, 170: intersect finger1/finger2 pointers
- Line 175-179: idom1/idom2 assignment pointers
- Line 188-189: blockDepth maybe_idom pointer
- Line 200-201: dominates maybe_idom pointer  
- Line 212: idominator return pointer
- Line 308: verify entry idom pointer
- Line 341: verify reachable block pointer
- Line 594-597: PostDominatorTree succ_ipdom pointer
- Line 600-603: old_ipdom comparison pointer
- Line 639: ipostDominator return pointer
- Line 672-677, 682-686: intersect ipdom pointers

Pattern: if (map.get(key)) |ptr| then use ptr.* to dereference
