---
title: "x64: emission"
status: closed
priority: 2
issue-type: task
created-at: "\"2026-01-01T11:01:30.849299+02:00\""
closed-at: "\"2026-01-01T16:49:34.150126+02:00\""
close-reason: "\"completed: src/backends/x64/emit.zig with binary encoding for mov/add/sub/push/pop/jmp/call/ret, REX prefixes, ModR/M encoding. All tests pass.\""
blocks:
  - hoist-474fd6bb31d63f3f
---

src/backends/x64/emit.zig (~3k LOC)

Port from: cranelift/codegen/src/isa/x64/inst/emit.rs

Binary encoding for all x64 instructions:

Prefixes:
- REX (64-bit, extended regs)
- VEX (AVX)
- 66, F2, F3 (operand size, SSE)

ModR/M byte:
- mod (00=mem, 01=disp8, 10=disp32, 11=reg)
- reg (register or opcode extension)
- rm (register or memory operand)

SIB byte (for scaled index):
- scale (1, 2, 4, 8)
- index register
- base register

Displacement and immediates:
- 8, 16, 32, 64-bit encodings

Each Inst variant has emit() method:
- Writes bytes to MachBuffer
- Handles label references for branches
