---
title: "machinst: ABI framework"
status: closed
priority: 1
issue-type: task
created-at: "\"2026-01-01T11:00:55.692623+02:00\""
closed-at: "\"2026-01-01T16:17:54.953889+02:00\""
close-reason: Completed ABI framework (~490 LOC) - ABIMachineSpec with System V AMD64 calling convention, arg/ret location computation, register allocation with all tests passing
blocks:
  - hoist-474fd4a2b20bac04
---

src/machinst/abi.zig (~1.2k LOC)

Port from: cranelift/codegen/src/machinst/abi.rs

ABIMachineSpec - calling convention interface:
- compute_arg_locs(sig) -> []ArgLoc
- compute_ret_locs(sig) -> []RetLoc
- gen_prologue(frame_size) -> []Inst
- gen_epilogue() -> []Inst
- gen_call(func, args) -> []Inst

ArgLoc:
- Reg(preg)
- Stack(offset)

Frame layout:
- saved_regs at known offsets
- locals
- outgoing args (for calls)

Backend-specific implementations:
- x64: SysV AMD64, Windows x64
- aarch64: AAPCS64
